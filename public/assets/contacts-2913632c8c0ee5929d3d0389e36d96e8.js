var authorizedSession=null,cardIndex=0,currentUser={id:null,email:null,username:null,realname:null,profilepic:null,slug:null,vote_btns:!0,admin:!1,unseen_bumps:0,unseen_refs:0},returnTrue=function(){return!0},hasSwiped=!1,hasKeySwiped=!1,hasSwitchedTags=!1,current_gallery_image=null,DEBUG=!1;(-1!=document.location.hostname.indexOf("localhost")||-1!=document.location.hostname.indexOf("staging.tagsurf.co")||-1!=document.location.hostname.indexOf("192.168")||-1!=document.location.hostname.indexOf("172.20"))&&(DEBUG=!0);var hasClass=function(e,t){return e.className&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)};Number.prototype.mod=function(e){return(this%e+e)%e},String.prototype.trunc=String.prototype.trunc||function(e){return this.length>e?this.substr(0,e-1)+"&hellip;":this};var toggleClass=function(e,t){var n=hasClass(this,e);n&&"on"!=t?this.classList.remove(e):n||"off"==t||this.classList.add(e)},galleries=["history","favorites","submissions","tag","bumps"],whichGallery=function(){for(var e=0;e<galleries.length;e++)if(-1!=document.location.pathname.indexOf(galleries[e]))return galleries[e];return null},isGallery=function(){var e=whichGallery();return null==e?!1:!0},isAuthorized=function(){return null!=authorizedSession?authorizedSession:(-1==document.location.href.indexOf("share")||-1!=document.location.href.indexOf("shares")?(authorizedSession=!0,isDesktop()||(currentUser.vote_btns=!1),setTimeout(function(){getUser()},3e3)):authorizedSession=!1,authorizedSession)},getUser=function(){authorizedSession&&!currentUser.id&&xhr("/api/users","GET",function(e){"not found"!=e.user&&(currentUser.id=e.user.id,currentUser.email=e.user.email,currentUser.username=e.user.username,currentUser.realname=e.user.first_name?e.user.first_name+" "+e.user.last_name:null,currentUser.profilepic=e.user.profile_pic_link,currentUser.slug=e.user.slug,currentUser.admin=e.user.admin,currentUser.safeSurf=e.user.safe_mode,currentUser.unseen_bumps=e.unseen_bumps,currentUser.unseen_refs=e.unseen_referrals,currentUser.unseen_bumps+currentUser.unseen_refs!=0&&updateMenuBadges(currentUser.unseen_bumps+currentUser.unseen_refs),isGallery()&&"bumps"==whichGallery()&&updateGalleryBadges(currentUser.unseen_refs,currentUser.unseen_bumps,!0))},function(e){"not found"==e.user&&DEBUG&&console.log("Error: User not found")}),setTimeout(function(){userStatsPoller()},5e3)},userStatsPoller=function(){xhr("/api/users","GET",function(e){"not found"!=e.user&&(currentUser.safeSurf=e.user.safe_mode,(currentUser.unseen_bumps!=e.unseen_bumps||currentUser.unseen_refs!=e.unseen_referrals)&&(currentUser.unseen_bumps=e.unseen_bumps,currentUser.unseen_refs=e.unseen_referrals,updateMenuBadges(currentUser.unseen_bumps+currentUser.unseen_refs),isGallery()&&"bumps"==whichGallery()&&updateGalleryBadges(currentUser.unseen_refs,currentUser.unseen_bumps)))},function(e){"not found"==e.user&&DEBUG&&console.log("Error: User not found")}),setTimeout(function(){userStatsPoller()},5e3)},current_tag,current_deck,cardCbs,tinput,inputContainer,slideContainer,scrollContainer,closeAutoComplete=function(e){e?(slideContainer.className="",scrollContainer.insertBefore(inputContainer,scrollContainer.firstChild)):modal.backOff(function(){slideContainer.className="",scrollContainer.insertBefore(inputContainer,scrollContainer.firstChild)}),tinput.active=!1},clearStack=function(){var e=current_deck.getEndCard();e&&e.unshow();for(var t=slideContainer.childNodes.length,n=0;t>n;n++)current_deck.cards[n].showing&&current_deck.cards[n].unshow()},newtags=[],pushTags=function(){if(newtags.length>0){for(;newtags.length;)xhr("/api/media/"+currentMedia.id+"/tags/"+newtags.shift(),"POST",null,null);autocomplete.populate()}},popTrending,fadeInBody=function(){addCss({"html, body":function(){return"width: "+window.innerWidth+"px; height: "+window.innerHeight+"px; opacity: 1;"}})},shareVotes=[],stashVotesAndLogin=function(){sessionStorage.setItem("lastPath",current_tag+"~"+currentMedia.id),sessionStorage.setItem("shareVotes",JSON.stringify(shareVotes)),window.location="/users/sign_in"};stashVotes=function(){sessionStorage.setItem("lastPath",current_tag+"~"+currentMedia.id),sessionStorage.setItem("shareVotes",JSON.stringify(shareVotes))};var messageBox=function(e,t,n,r,s){var i=document.createElement("div"),a=document.createElement("div"),o=document.createElement("img"),u=document.createElement("p"),l=document.createElement("p"),d=document.createElement("div");s="undefined"==typeof s?!1:s,a.className="close-button-container pointer",o.className="x-close-button",o.src="http://assets.tagsurf.co/img/Close.png",gesture.listen("down",a,modal.callPrompt),a.appendChild(o),i.appendChild(a),u.className="prompt-title",u.innerHTML=e?e:"Oops",i.appendChild(u),l.className="prompt-message",l.innerHTML=t?t:"Something went wrong",i.appendChild(l),d.className="msgbox-btn","undefined"==typeof n?(d.innerHTML="OK",r?gesture.listen("tap",d,r):gesture.listen("tap",d,modal.callPrompt)):(d.innerHTML=n,"login"!=n||r?r?gesture.listen("tap",d,r):gesture.listen("tap",d,modal.callPrompt):gesture.listen("tap",d,function(){window.location="/users/sign_in"})),gesture.listen("down",d,function(){d.classList.add("ts-active-button")}),gesture.listen("up",d,function(){d.classList.remove("ts-active-button")}),i.appendChild(d),modal.promptIn(i,null,s)},buildVoteButtons=function(e,t){var n=document.createElement("div"),r=document.createElement("div"),s=document.createElement("img"),i=document.createElement("img");s.src="http://assets.tagsurf.co/img/downvote_btn.png",i.src="http://assets.tagsurf.co/img/upvote_btn.png",s.id="downvote-icon",i.id="upvote-icon",r.className="vote-button hidden",r.id="vote-button-left",n.className="vote-button hidden",n.id="vote-button-right",r.appendChild(s),n.appendChild(i),gesture.listen("down",r,function(){r.firstChild.src="http://assets.tagsurf.co/img/downvote_btn-invert.png"}),gesture.listen("up",r,function(){setTimeout(function(){r.firstChild.src="http://assets.tagsurf.co/img/downvote_btn.png"},200)}),gesture.listen("tap",r,function(){modal.zoom.zoomed&&modal.callZoom(1),cardCbs.drag("left",-1,-1),setTimeout(function(){t("left")},200),analytics.track("Tap Downvote Button")}),gesture.listen("down",n,function(){n.firstChild.src="http://assets.tagsurf.co/img/upvote_btn-invert.png"}),gesture.listen("up",n,function(){setTimeout(function(){n.firstChild.src="http://assets.tagsurf.co/img/upvote_btn.png"},200)}),gesture.listen("tap",n,function(){modal.zoom.zoomed&&modal.callZoom(1),cardCbs.drag("right",1,1),setTimeout(function(){t("right")},200),analytics.track("Tap Upvote Button")}),document.body.appendChild(r),document.body.appendChild(n)},voteButtonsOn=function(){document.getElementById("vote-button-right")&&(toggleClass.apply(document.getElementById("vote-button-right"),["hidden","off"]),toggleClass.apply(document.getElementById("vote-button-left"),["hidden","off"]))},voteButtonsOff=function(){document.getElementById("vote-button-right")&&(toggleClass.apply(document.getElementById("vote-button-right"),["hidden","on"]),toggleClass.apply(document.getElementById("vote-button-left"),["hidden","on"]))},flashVoteButton=function(e){"right"==e?(document.getElementById("upvote-icon").src="http://assets.tagsurf.co/img/upvote_btn-invert.png",setTimeout(function(){document.getElementById("upvote-icon").src="http://assets.tagsurf.co/img/upvote_btn.png"},300)):"left"==e&&(document.getElementById("downvote-icon").src="http://assets.tagsurf.co/img/downvote_btn-invert.png",setTimeout(function(){document.getElementById("downvote-icon").src="http://assets.tagsurf.co/img/downvote_btn.png"},300))},currentMedia,panicCb,checkShare=function(e){var t=currentMedia;if(t&&-1!=t.type.indexOf("content")){if(share.on(t,e),refer.on(t),whichGallery())return;panic.on(t,panicCb),currentUser.vote_btns&&voteButtonsOn()}else t&&"login"==t.type?currentUser.vote_btns&&voteButtonsOn():(share.off(),panic.off(),voteButtonsOff(),addBarSlid&&slideAddBar())},setCurrentMedia=function(e,t){currentMedia=e,checkShare(t)},_addCss=function(e){var t=document.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)},addedCss=[],addCss=function(e,t){var n,r="";for(n in e)r+=n+" { "+e[n]()+" } ";isNaN(t)&&addedCss.push(e),_addCss(r)},getOrientation=function(){return window.innerWidth<window.innerHeight?"portrait":"landscape"},maxCardHeight,resizeCb,setMaxCardHeight=function(){maxCardHeight=window.innerHeight-240},setResizeCb=function(e){resizeCb=e};setMaxCardHeight();var lastWidth=window.innerWidth;window.onresize=function(){!isDesktop()&&lastWidth==window.innerWidth||throbber.active||(lastWidth=window.innerWidth,setMaxCardHeight(),addedCss.forEach(addCss),resizeCb&&resizeCb())};var xhr=function(e,t,n,r,s,i,a){var o=new XMLHttpRequest;DEBUG&&console.log("XHR Request. Path: "+e+" action: "+(t||"GET")),"undefined"==typeof s&&(s=!0),"undefined"==typeof a&&(a=!1),o.open(t||"GET",e,s),("PATCH"==t||a)&&o.setRequestHeader("Content-type","application/json"),o.onreadystatechange=function(){if(4==o.readyState){var t="<"==o.responseText.charAt(0)?{errors:o.responseText}:JSON.parse(o.responseText);if(t.errors||200!=o.status){if(r&&r(t,o.status),DEBUG&&401!=o.status&&404!=o.status){var s="XHR error! Request failed. Path:"+e+" Errors: "+t.errors+" Response: "+o.responseText+" Status: "+o.status;console.log(s),!isDesktop()&&alert(s)}}else n&&n(t)}},o.send(i)},mod=function(e){for(var t=e.targets?e.targets:e.target?[e.target]:e.className?document.getElementsByClassName(e.className):e.id?[document.getElementById(e.id)]:[],n=e.property||"display",r=e.value||(e.show?"block":e.hide?"none":""),s=0;s<t.length;s++)t[s].style[n]=r},__ua=navigator.userAgent,_ua={isUIWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(__ua),isSafariOrUIWebView:/(iPhone|iPod|iPad).*AppleWebKit/i.test(__ua),isIphone:-1!=__ua.indexOf("iPhone"),isIpad:-1!=__ua.indexOf("iPad"),isIos:-1!=__ua.indexOf("iPhone")||-1!=__ua.indexOf("iPad"),isMobile:-1!=__ua.toLowerCase().indexOf("mobile"),isAndroid:-1!=__ua.indexOf("Android"),isNativeAndroid:-1!=__ua.indexOf("AndroidWebView"),isFacebook:-1!=__ua.indexOf("FB"),isStockAndroid:-1!=__ua.indexOf("Mozilla/5.0")&&-1!=__ua.indexOf("Android ")&&-1!=__ua.indexOf("AppleWebKit")&&-1==__ua.indexOf("Chrome")},isIos=function(){return _ua.isIos},isUIWebView=function(){return _ua.isUIWebView&&!_ua.isFacebook},isIpad=function(){return _ua.isIpad},isIphone=function(){return _ua.isIphone},isDesktop=function(){return!_ua.isMobile&&!_ua.isAndroid&&!_ua.isIos},isTablet=function(){return _ua.isIpad||_ua.isAndroid&&!_ua.isMobile},isMobile=function(){return _ua.isMobile},isAndroid=function(){return _ua.isAndroid},isNativeAndroid=function(){return _ua.isNativeAndroid},isStockAndroid=function(){return _ua.isStockAndroid},isFacebook=function(){return _ua.isFacebook},isNarrow=function(){return window.innerWidth<700},isFacebook=function(){return _ua.isFacebook},trans=function(e,t,n,r){var s,i=n&&1==n.split(" ").length,a=function(){n&&(i?e.classList.remove(n):e.style["-webkit-transition"]=""),r&&(e.style["-webkit-transform"]=""),s&&(clearTimeout(s),s=null),e.removeEventListener("webkitTransitionEnd",a,!1),t&&t()};e.addEventListener("webkitTransitionEnd",a,!1),n&&(i?e.classList.add(n):(e.style["-webkit-transition"]=n,s=setTimeout(a,parseInt(n.split(" ")[1])))),r&&(e.style["-webkit-transform"]=r)},validEmail=function(e){var t=e.indexOf("@",1),n=e.indexOf(".",t);return-1==t||-1==n||n==e.length-1||t+2>n?!1:!0},requestAnimFrame;!function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),s=window.setTimeout(function(){t(n+r)},r);return e=n+r,s}),requestAnimFrame=window.requestAnimationFrame,window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var stroke={keys:{},cbs:{up:{},down:{}},init:function(){window.onkeydown=function(e){e=e||window.event;var t=e.keyCode||e.which,n=stroke.cbs.down.always,r=stroke.cbs.down[t],s=Date.now(),i=stroke.keys[t]=stroke.keys[t]&&!stroke.keys[t].up?stroke.keys[t]:{duration:0};i.down&&(i.duration+=s-i.down),i.down=s,i.code=t,n&&n(i),r&&r(i)},window.onkeyup=function(e){e=e||window.event;var t=e.keyCode||e.which,n=Date.now(),r=stroke.keys[t]=stroke.keys[t]||{down:n},s=stroke.cbs.up.always,i=stroke.cbs.up[t];r.up=n,r.code=t,r.duration+=r.up-r.down,s&&s(r),i&&i(r)}},isDown:function(e){var t=stroke.keys[e],n=t&&!t.up;return n},listen:function(e,t,n){stroke.cbs[e][t||"always"]=n},unlisten:function(e,t){delete stroke.cbs[e][t||"always"]}};stroke.init();var gesture={gid:0,preventDefault:!0,stopPropagation:!0,thresholds:{swipe:{minDistance:35,maxTime:400,minDP:600,maxDP:1e3},drag:{minDP:0,maxDP:1e3},tap:{maxDistance:10,maxTime:700,waitTime:300,maxCount:2},hold:{maxDistance:null,interval:1e3},up:{androidDelay:600},pinch:{}},_vars:{active:!1,startTime:null,dragTime:null,startPos:null,lastPos:null,tapCount:0,holdCount:0,tapTimeout:null,holdInterval:null,stopTimeout:null,firstPinch:null,stopPropagation:!1,preventDefault:!1,iosPinch:!1,iosPinching:!1},gevents:{GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend"},events:isMobile()&&{Start:"touchstart",Stop:"touchend",Move:"touchmove",Cancel:"touchcancel"}||{Start:"mousedown",Stop:"mouseup",Move:"mousemove"},handlers:{drag:{},swipe:{},tap:{},up:{},down:{},hold:{},pinch:{}},tuneThresholds:function(){if(!isIos())for(var e in gesture.thresholds)for(var t in gesture.thresholds[e]){var n=t.slice(3);"Distance"==n?gesture.thresholds[e][t]/=2:"DP"==n&&(gesture.thresholds[e][t]*=2)}},getPos:function(e){return void 0==e.x&&(e.x=e.pageX||e.changedTouches[0].pageX,e.y=e.pageY||e.changedTouches[0].pageY),{x:e.x,y:e.y}},getDiff:function(e,t){var n={};return n.x=t.x-e.x,n.y=t.y-e.y,n.distance=Math.sqrt(n.x*n.x+n.y*n.y),n.direction=Math.abs(n.x)>Math.abs(n.y)?n.x>0?"right":"left":n.y>0?"down":"up",n},pinchDiff:function(e){return isIos()?e.scale:gesture.getDiff(gesture.getPos(e.touches[0]),gesture.getPos(e.touches[1]))},pixelsPerSecond:function(e,t,n){var r=gesture.thresholds[n];return Math.min(r.maxDP,Math.max(r.minDP,e/t))*(isIos()?1:.5)},isMulti:function(e){return isMobile()&&e.touches.length>1},onGestureStart:function(){},onGestureChange:function(e,t){gesture.triggerPinch(t,Math.pow(e.scale,1/3))},onGestureEnd:function(e,t){gesture.triggerPinch(t),t.gvars.iosPinching=!1},onStart:function(e,t){var n=gesture.thresholds,r=t.gvars;return r.active=!0,r.holdCount=0,r.startTime=r.dragTime=Date.now(),r.startPos=r.lastPos=gesture.getPos(e),r.tapTimeout&&(clearTimeout(r.tapTimeout),r.tapTimeout=null),gesture.isMulti(e)?isAndroid()?r.firstPinch=gesture.pinchDiff(e):r.iosPinching=!0:r.holdInterval=setInterval(function(){return!r.active||n.hold.maxDistance&&n.hold.maxDistance<gesture.getDiff(r.startPos,r.lastPos).distance?(clearInterval(r.holdInterval),void(r.holdInterval=null)):(r.holdCount+=1,void gesture.triggerHold(t,n.hold.interval*r.holdCount))},n.hold.interval),gesture.triggerDown(t)},onStop:function(e,t,n){var r=t.gvars;if(!n&&r.holdInterval&&(clearInterval(r.holdInterval),r.holdInterval=null),r.active){var s=gesture.thresholds,i=gesture.getPos(e),a=gesture.getDiff(r.startPos,i),o=Date.now()-r.startTime;return r.active=!(!e.touches||!e.touches.length),e.touches&&1==e.touches.length&&gesture.triggerPinch(t),r.active||r.iosPinching||(o<s.swipe.maxTime&&a.distance>s.swipe.minDistance?gesture.triggerSwipe(t,a.direction,a.distance,a.x,a.y,gesture.pixelsPerSecond(a.distance,o,"swipe")):o<s.tap.maxTime&&a.distance<s.tap.maxDistance&&(r.tapCount+=1,r.tapCount==s.tap.maxCount?gesture.triggerTap(t):r.tapTimeout=setTimeout(gesture.triggerTap,s.tap.waitTime,t))),gesture.triggerUp(t,n)}},onMove:function(e,t){var n=t.gvars;if(n.active){var r=gesture.getPos(e),s=gesture.getDiff(n.lastPos,r),i=Date.now(),a=i-n.dragTime;if(n.lastPos=r,n.dragTime=i,!gesture.isMulti(e))return gesture.triggerDrag(t,s.direction,s.distance,s.x,s.y,gesture.pixelsPerSecond(s.distance,a,"drag"));isAndroid()&&gesture.triggerPinch(t,gesture.pinchDiff(e).distance/n.firstPinch.distance)}},gWrap:function(e){var t={};return["GestureStart","GestureChange","GestureEnd"].forEach(function(n){t[n]=function(t){return t.preventDefault(),t.stopPropagation(),gesture["on"+n](t,e)||!1}}),t},eWrap:function(e){var t={};return["Start","Stop","Move"].forEach(function(n){t[n]=function(t){return e.gvars.preventDefault&&t.preventDefault(),e.gvars.stopPropagation&&t.stopPropagation(),gesture["on"+n](t,e)||gesture.preventDefault&&t.preventDefault()||gesture.stopPropagation&&t.stopPropagation()||!1}}),gesture.events.Cancel&&(t.Cancel=t.Stop),t},listen:function(e,t,n,r,s){if(!t.gid){t.gid=++gesture.gid;var i=t.listeners=gesture.eWrap(t);for(var a in gesture.events)t.addEventListener(gesture.events[a],i[a]);t.gvars=JSON.parse(JSON.stringify(gesture._vars))}if("pinch"==e&&isIos()){var o=gesture.gWrap(t);for(var a in gesture.gevents)t.addEventListener(gesture.gevents[a],o[a]);for(var u in o)t.listeners[u]=o[u];t.gvars.iosPinch=!0}t.gvars.stopPropagation=r,t.gvars.preventDefault=s,gesture.handlers[e][t.gid]||(gesture.handlers[e][t.gid]=[]),gesture.handlers[e][t.gid].push(n)},unlisten:function(e){if(e.gid){var t=e.listeners;for(var n in gesture.events)e.removeEventListener(gesture.events[n],t[n]);if(e.gvars.iosPinch)for(var n in gesture.gevents)e.removeEventListener(gesture.gevents[n],t[n]);for(var r in gesture.handlers)e.gid in gesture.handlers[r]&&delete gesture.handlers[r][e.gid];delete e.gid}},triggerPinch:function(e,t){var n=gesture.handlers.pinch[e.gid];if(n)for(var r=0;r<n.length;r++)n[r](t)},triggerSwipe:function(e,t,n,r,s,i){var a=gesture.handlers.swipe[e.gid];if(hasSwiped=!0,a)for(var o=0;o<a.length;o++)a[o](t,n,r,s,i)},triggerTap:function(e){var t=e.gvars,n=gesture.handlers.tap[e.gid];if(n)for(var r=0;r<n.length;r++)n[r](t.tapCount);t.tapCount=0,t.tapTimeout=null},triggerDrag:function(e,t,n,r,s,i){var a=!1,o=gesture.handlers.drag[e.gid];if(o)for(var u=0;u<o.length;u++)a=o[u](t,n,r,s,i)||a;return a},triggerHold:function(e,t){var n=gesture.handlers.hold[e.gid];if(n)for(var r=0;r<n.length;r++)n[r](t)},triggerUp:function(e,t){var n=!1,r=gesture.handlers.up[e.gid];if(r)for(var s=0;s<r.length;s++)n=r[s](t)||n;return n},triggerDown:function(e){var t=!1,n=gesture.handlers.down[e.gid];if(n)for(var r=0;r<n.length;r++)t=n[r]()||t;return t}};gesture.tuneThresholds();var drag={_direction2constraint:{up:"horizontal",down:"horizontal",left:"vertical",right:"vertical"},nativeScroll:function(e,t){gesture.listen("up",e,function(){return t.up&&t.up(),!0},!0,!1),gesture.listen("down",e,function(){return t.down&&t.down(),!0},!0,!1);var n,r,s={up:"down",down:"up",right:"left",left:"right"},i=function(){r&&(clearTimeout(r),r=null),r=setTimeout(function(){t.drag(s[n],0,0,0)},100)};gesture.listen("drag",e,function(r,s,i,a){{var o=e.parentNode.scrollHeight-e.parentNode.scrollTop===e.parentNode.clientHeight,u=0===e.parentNode.scrollTop;0===e.parentNode.scrollLeft,e.parentNode.clientWidth+e.parentNode.scrollLeft===e.parentNode.scrollWidth}return n=r,t.drag&&t.drag(r,s,i,a),u&&"down"==r||o&&"up"==r?!1:!t.constraint||t.constraint==drag._direction2constraint[r]},!0,!1),gesture.listen("swipe",e,function(n){"up"==n&&e.parentNode.scrollTop>=e.parentNode.scrollHeight-(e.parentNode.clientHeight+800)&&t.swipe&&t.swipe()},!0,!1),e.parentNode.addEventListener("scroll",function(e){return t.scroll&&t.scroll(e),t.drag&&i(),!0},!1)},makeDraggable:function(e,t){if(t=t||{},!t.interval&&!t.force&&!isStockAndroid())return drag.nativeScroll(e.firstChild,t);var n,r,s,i;e.xDrag=0,e.yDrag=0,e.classList.add("hardware-acceleration"),e.style["-webkit-transform"]="translate3d(0,0,0)",-1==e.className.indexOf("carousel")&&(e.style.overflow="visible",e.parentNode.style.overflow="visible"),e.parentNode.addEventListener("scroll",function(){return!1},!1),n=function(){e.animating||(e.dragging=!1,e.touchedDown=!0,e.animating=!1,e.xDragStart=e.xDrag,e.yDragStart=e.yDrag,t.down&&t.down())},r=function(n){var r=0,s=0,i=!1;e.touchedDown=e.dragging=!1,0==e.animating&&(t.interval?("vertical"!=t.constraint&&(s=e.yDrag%t.interval,0!=s&&(e.yDrag-=Math.abs(s)<=t.interval/2?s:t.interval+s,n=e.yDrag<e.yDragStart?"up":e.yDrag>e.yDragStart?"down":"hold")),"horizontal"!=t.constraint&&(r=e.xDrag%t.interval,0!=r&&(e.xDrag-=Math.abs(r)<=t.interval/2?r:t.interval+r,n=e.xDrag<e.xDragStart?"left":e.xDrag>e.xDragStart?"right":"hold")),n&&(e.animating=!0,trans(e,function(){e.animating=!1},"-webkit-transform 300ms ease-out"),e.style["-webkit-transform"]="translate3d("+e.xDrag+"px,"+e.yDrag+"px,0)")):("horizontal"!=t.constraint&&(e.xDrag>0?(e.xDrag=0,i=!0,n="right"):Math.abs(e.xDrag)>e.scrollWidth-e.parentNode.clientWidth&&(e.xDrag=-(e.scrollWidth-e.parentNode.clientWidth),i=!0,n="left")),"vertical"!=t.constraint&&(e.yDrag>0?(e.yDrag=0,i=!0,n="up"):e.yDrag<-(e.scrollHeight-e.parentNode.clientHeight)&&(e.yDrag=-(e.scrollHeight-e.parentNode.clientHeight),i=!0,n="down")),i&&(e.animating=!0,trans(e,function(){e.animating=!1,t.drag&&t.drag(n,0,0,0),t.scroll&&t.scroll()},"-webkit-transform 300ms ease-out"),e.style["-webkit-transform"]="translate3d("+e.xDrag+"px,"+e.yDrag+"px,0)")),t.up&&t.up(n))},s=function(n,r,s,i){e.touchedDown&&(e.dragging=!0,"vertical"!=t.constraint&&e.yDrag>-(e.scrollHeight-2*e.parentNode.clientHeight/3)&&(e.yDrag+=i),"horizontal"!=t.constraint&&Math.abs(e.xDrag)<e.scrollWidth-2*e.parentNode.clientWidth/3&&(e.xDrag+=s),e.style["-webkit-transform"]="translate3d("+e.xDrag+"px,"+e.yDrag+"px,0)",t.drag&&t.drag(n,r,s,i),t.scroll&&t.scroll())},i=function(n,s,i,a,o){var u=t.interval?e.xDrag%t.interval:-i,l=t.interval?e.yDrag%t.interval:.3*o;if(0==e.animating){if("horizontal"!=t.constraint&&e.xDrag<=0&&Math.abs(e.xDrag)<e.scrollWidth-e.parentNode.clientWidth)if("right"==n)e.xDrag-=u;else{if("left"!=n)return;e.xDrag+=t.interval?-(t.interval+u):u}if("vertical"!=t.constraint&&e.yDrag<=0&&e.yDrag>-(e.scrollHeight-e.parentNode.clientHeight))if("up"==n)e.yDrag-=l;else{if("down"!=n)return;e.yDrag-=t.interval?-(t.interval+l):-l}trans(e,function(){e.animating=!1,r(n)},"-webkit-transform 300ms ease-out"),e.animating=!0,e.style["-webkit-transform"]="translate3d("+e.xDrag+"px,"+e.yDrag+"px,0)"}},e.isDraggable&&gesture.unlisten(e),e.isDraggable=!0,gesture.listen("drag",e,s),gesture.listen("down",e,n),gesture.listen("swipe",e,i),gesture.listen("up",e,r)}};